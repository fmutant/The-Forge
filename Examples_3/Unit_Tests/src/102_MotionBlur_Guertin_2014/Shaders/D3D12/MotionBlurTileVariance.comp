RWTexture2D<float2> TileVariance: register(u0);
Texture2D<float2> TileMaxTexture : register(t11);

[numthreads(16, 1, 1)]
void main(int3 DTid: SV_DispatchThreadID)
{
	float tile_variance = 0.0f;
	
	int3 coords = int3(DTid.xy, 0);
	float2 this_tile = TileMaxTexture.Load(coords);
	tile_variance += abs(dot(this_tile, this_tile));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2(-1, -1))));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2(-1,  0))));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2(-1,  1))));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2( 0, -1))));
	//tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2( 0,  0))));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2( 0,  1))));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2( 1, -1))));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2( 1,  0))));
	tile_variance += abs(dot(this_tile, TileMaxTexture.Load(coords, int2( 1,  1))));
	
	TileVariance[DTid.xy] = 1.0f - tile_variance / 9.0f;
}
