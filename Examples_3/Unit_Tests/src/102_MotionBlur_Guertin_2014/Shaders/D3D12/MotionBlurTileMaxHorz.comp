RWTexture2D<float2> TileMaxHorz: register(u0);
Texture2D<float2> VelocityTexture : register(t0);

cbuffer cbMotionBlurConsts : register(b3)
{
	int4 consts;
	int4 sizes;
}

float2 vmax(float2 v0, float2 v1)
{
	return dot(v0, v0) < dot(v1, v1) ? v1 : v0;
}

[numthreads(16, 8, 1)]
void main(uint3 DTid : SV_DispatchThreadID)
{
	if (any(sizes.zy < DTid.xy))
	{
		TileMaxHorz[DTid.xy] = 0;
		return;
	}
	int2 coords = int2(DTid.x * consts.x, DTid.y);
	
	float2 tile_max = float2(0.0f, 0.0f);
	for (int i = 0; i < consts.x; ++i)
	{
		int3 xyl = int3(coords, 0);
		xyl.x += i;
		float2 velocity = VelocityTexture.Load(xyl);
		tile_max = vmax(velocity, tile_max);
	}
	TileMaxHorz[DTid.xy] = tile_max;

}
